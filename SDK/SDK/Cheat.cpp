#include "Cheat.h"
#include "ActorMgr.h"
#include "math\Vector2D.hpp"
#include "Color.h"
#include "hooks.h"
#include "D3dDraw.h"

//typedef bool(__fastcall *_GameWorldToSceen)(Vector location, Vector2D &out);
//_GameWorldToSceen world2screen;
Draw* D = new Draw;
CCheats *GetCheat()
{
	static CCheats m;
	return &m;
}

CCheats::CCheats()
{

	m_pActor = new CActorMgr;
}

CCheats::~CCheats()
{
	delete m_pActor;
}


void AddItemName(int id, char *pCN, char *pEN, char *pTexture)
{
	ITEM_NAME in;
	lstrcpyA(in.szCN, pCN);
	lstrcpyA(in.szEN, pEN);
	lstrcpyA(in.szTexture, pTexture);
	g_ItemHash[id] = in;
}

void InitItemName()
{
	//SEProtectStartMutation();
	g_ItemHash.clear();
	//Weapons
	AddItemName(GOLD_KRABER, "克雷贝尔狙击枪", "Kraber", "收");		//1
	AddItemName(GOLD_MASTIFF, "獒犬霰弹枪", "Mastiff", "藏");			//1
	AddItemName(GOLD_LSTAR, "L-Star EMG", "L-Star EMG", "A");
	AddItemName(GOLD_HAVOC, "哈沃克", "HowGun", "");
	AddItemName(DEVOTION, "专注轻机枪", "Devotion", "致");
	AddItemName(TRIPLE_TAKE, "三重式狙击枪", "Triple Take", "结");
	AddItemName(GOLD_TRIPLE_TAKE, "黄金三重式狙击枪", "Triple Take", "结");
	AddItemName(FLATLINE, "VK-47平行步枪", "Flatline", "");
	AddItemName(GOLD_FLATLINE, "黄金VK-47平行步枪", "Flatline", "");
	AddItemName(HEMLOCK, "赫姆洛克突击步枪", "Hemlok", "闰");		//1
	AddItemName(G7_SCOUT, "G7侦查枪", "G7 Scout", "阳");
	AddItemName(GOLD_G7_SCOUT, "黄金G7侦查枪", "G7 Scout", "阳");
	AddItemName(ALTERNATOR, "转换者冲锋枪", "Alternator", "腾");
	AddItemName(GOLD_ALTERNATOR, "黄金转换者冲锋枪", "Alternator", "腾");
	AddItemName(R_99, "R-99冲锋枪", "R-99", "律");
	AddItemName(PROWLER, "潜袭冲锋枪", "Prowler", "霜");
	AddItemName(GOLD_PROWLER, "黄金潜袭冲锋枪", "Prowler", "霜");
	AddItemName(LONGBOW, "长弓精确步枪", "Longbow", "雨");
	AddItemName(GOLD_LONGBOW, "黄金长弓精确步枪", "Longbow", "雨");
	AddItemName(CHARGE_RIFLE, "充能步枪", "EntGun", "");
	AddItemName(GOLD_CHARGE_RIFLE, "黄金充能步枪", "EntGun", "");
	AddItemName(SPITFIRE, "M600喷火轻机枪", "Spitfire", "调");
	AddItemName(R_301, "R-301卡宾枪", "R-301", "岁");
	AddItemName(EVA_8_AUTO, "EVA-8自动霰弹枪", "EVA-8 Auto", "云");	//1
	AddItemName(PEACEKEEPER, "和平捍卫者霰弹枪", "Peacekeeper", "冬");
	AddItemName(GOLD_PEACEKEEPER, "黄金和平捍卫者霰弹枪", "Peacekeeper", "冬");
	AddItemName(MOZAMBIQUE, "莫桑比克霰弹枪", "Mozambique", "为");
	AddItemName(GOLD_MOZAMBIQUE, "黄金莫桑比克霰弹枪", "Mozambique", "为");
	AddItemName(WINGMAN, "辅助手枪", "Wingman", "露");
	AddItemName(GOLD_WINGMAN, "黄金辅助手枪", "Wingman", "露");
	AddItemName(P2020, "P2020手枪", "P2020", "吕");
	AddItemName(GOLD_P2020, "黄金P2020手枪", "P2020", "吕");
	AddItemName(RE_45, "RE-45自动手枪", "RE-45", "成");
	AddItemName(GOLD_RE_45, "黄金RE-45自动手枪", "RE-45", "成");
	
	//Ammo
	AddItemName(LIGHT_ROUNDS, "轻型弹药", "Light Rounds", "");
	AddItemName(ENERGY_AMMO, "能量弹药", "Energy Ammo", "");
	AddItemName(SHOTGUN_SHELLS, "霰弹弹药", "Shotgun Shells", "");
	AddItemName(HEAVY_ROUNDS, "重型弹药", "Heavy Rounds", "");

	//Healing Items
	AddItemName(ULTIMATE_ACCELERANT, "绝招加速剂", "Ultimate Accelerant", "");
	AddItemName(PHOENIX_KIT, "凤凰治疗包", "Phoenix Kit", "金");
	AddItemName(MED_KIT, "医疗箱", "Med Kit", "水");
	AddItemName(SYRINGE, "注射器", "Syringe", "丽");
	AddItemName(SHIELD_BATTERY, "大型护盾电池", "Shield Battery", "玉");
	AddItemName(SHIELD_CELL, "小型护盾电池", "Shield Cell", "出");

	//Shield Items

	AddItemName(HELMET_LV1, "头盔(lv1)", "Helmet Level 1", "生 lv1");
	AddItemName(HELMET_LV2, "头盔(lv2)", "Helmet Level 2", "生 lv2");
	AddItemName(HELMET_LV3, "头盔(lv3)", "Helmet Level 3", "生 lv3");
	AddItemName(HELMET_LV4, "头盔(lv4)", "Helmet Level 4", "生 lv4");
	AddItemName(BODY_ARMOR_LV1, "防弹衣(lv1)", "Body Armor Level 1", "冈 lv1");
	AddItemName(BODY_ARMOR_LV2, "防弹衣(lv2)", "Body Armor Level 2", "冈 lv2");
	AddItemName(BODY_ARMOR_LV3, "防弹衣(lv3)", "Body Armor Level 3", "冈 lv3");
	AddItemName(BODY_ARMOR_LV4, "防弹衣(lv4)", "Body Armor Level 4", "冈 lv4");
	AddItemName(KNOCKDOWN_SHIELD_LV1, "击倒护盾(lv1)", "Knockdown Shield Level 1", "号 lv1");
	AddItemName(KNOCKDOWN_SHIELD_LV2, "击倒护盾(lv2)", "Knockdown Shield Level 2", "号 lv2");
	AddItemName(KNOCKDOWN_SHIELD_LV3, "击倒护盾(lv3)", "Knockdown Shield Level 3", "号 lv3");
	AddItemName(KNOCKDOWN_SHIELD_LV4, "击倒护盾(lv4)", "Knockdown Shield Level 4", "号 lv4");
	AddItemName(BACKPACK_LV1, "背包(lv1)", "Backpack Level 1", "剑 lv1");
	AddItemName(BACKPACK_LV2, "背包(lv2)", "Backpack Level 2", "剑 lv2");
	AddItemName(BACKPACK_LV3, "背包(lv3)", "Backpack Level 3", "剑 lv3");
	AddItemName(BACKPACK_LV4, "背包(lv4)", "Backpack Level 4", "剑 lv4");

	//Grenades
	AddItemName(THERMITE_GRENADE, "铝热剂手雷", "Thermite Grenade", "");
	AddItemName(FRAG_GRENADE, "破片手雷", "Frag Grenade", "巨");
	AddItemName(ARC_STAR, "飞镖", "Arc Star", "阙");


	//Attachment Scopes
	AddItemName(HCOG_CLASSIC, "单倍全息", "1x HCOG (Classic)", "盈");
	AddItemName(HCOG_BRUISER, "2倍全息", "2x HCOG (Bruiser)", "往");
	AddItemName(HOLO, "单倍幻影", "1x Holo", "昃");
	AddItemName(VARIABLE_HOLO, "1-2倍幻影", "1x-2x Variable Holo", "天");
	AddItemName(DIGITAL_THREAT, "1倍数字化镜", "1x Digital Threat", "月");
	AddItemName(HCOG_RANGER, "3倍全息", "3x HCOG (Ranger)", "暑");
	AddItemName(VARIABLE_AOG, "2-4倍瞄准镜", "2x-4x Variable AOG", "秋");
	AddItemName(SNIPER, "6倍狙击瞄准镜", "6x Sniper", "张");
	AddItemName(VARIABLE_SNIPER, "4-8倍瞄准镜", "4x-8x Variable Sniper", "来");
	AddItemName(DIGITAL_SNIPER_THREAT, "4-10倍瞄准镜", "4x-10x Digital Sniper Threat", "寒");

	//Attachments
	AddItemName(BARREL_STABILIZER_LV1, "枪管稳定器(lv1)", "Barrel Stabilizer Level 1", "宙 lv1");
	AddItemName(BARREL_STABILIZER_LV2, "枪管稳定器(lv2)", "Barrel Stabilizer Level 2", "宙 lv2");
	AddItemName(BARREL_STABILIZER_LV3, "枪管稳定器(lv3)", "Barrel Stabilizer Level 3", "宙 lv3");
	AddItemName(BARREL_STABILIZER_LV4, "枪管稳定器(lv4)", "Barrel Stabilizer Level 4", "宙 lv4");
	AddItemName(LIGHT_MAGAZINE_LV1, "加长式轻型弹匣lv1)", "Light Magazine Level 1", "日 lv1");
	AddItemName(LIGHT_MAGAZINE_LV2, "加长式轻型弹匣(lv2)", "Light Magazine Level 2", "日 lv2");
	AddItemName(LIGHT_MAGAZINE_LV3, "加长式轻型弹匣(lv3)", "Light Magazine Level 3", "日 lv3");
	AddItemName(HEAVY_MAGAZINE_LV1, "加长式重型弹匣(lv1)", "Heavy Magazine Level 1", "荒 lv1");
	AddItemName(HEAVY_MAGAZINE_LV2, "加长式重型弹匣(lv2)", "Heavy Magazine Level 2", "荒 lv2");
	AddItemName(HEAVY_MAGAZINE_LV3, "加长式重型弹匣(lv3)", "Heavy Magazine Level 3", "荒 lv3");

	AddItemName(ENERGY_MAGAZINE_LV1, "加长式能量弹匣(lv1)", "ENERGY Magazine Level 1", "荒 lv1");
	AddItemName(ENERGY_MAGAZINE_LV2, "加长式能量弹匣(lv2)", "ENERGY Magazine Level 2", "荒 lv2");
	AddItemName(ENERGY_MAGAZINE_LV3, "加长式能量弹匣(lv3)", "ENERGY Magazine Level 3", "荒 lv3");

	AddItemName(SHOTGUN_BOLT_LV1, "霰弹枪枪栓(lv1)", "Shotgun Bolt Level 1", "宇 lv1");
	AddItemName(SHOTGUN_BOLT_LV2, "霰弹枪枪栓(lv2)", "Shotgun Bolt Level 2", "宇 lv2");
	AddItemName(SHOTGUN_BOLT_LV3, "霰弹枪枪栓(lv3)", "Shotgun Bolt Level 3", "宇 lv3");
	AddItemName(STANDARD_STOCK_LV1, "标准枪托(lv1)", "Standard Stock Level 1", "辰 lv1");
	AddItemName(STANDARD_STOCK_LV2, "标准枪托(lv2)", "Standard Stock Level 2", "辰 lv2");
	AddItemName(STANDARD_STOCK_LV3, "标准枪托(lv3)", "Standard Stock Level 3", "辰 lv3");
	AddItemName(SNIPER_STOCK_LV1, "狙击枪枪托(lv1)", "Sniper Stock Level 1", "洪 lv1");
	AddItemName(SNIPER_STOCK_LV2, "狙击枪枪托(lv2)", "Sniper Stock Level 2", "洪 lv2");
	AddItemName(SNIPER_STOCK_LV3, "狙击枪枪托(lv3)", "Sniper Stock Level 3", "洪 lv3");
	AddItemName(TURBOCHARGER, "涡轮增压器", "Turbocharger", "黄");
	AddItemName(SELECTFIRE_RECEIVER, "选择射击模式器", "Selectfire Receiver", "地");
	AddItemName(PRECISION_CHOKE, "精准束器", "Precision Choke", "宿");
	AddItemName(anvilreceiver, "Disruptor Rounds", "Precision Choke", "宿");
	AddItemName(doubletaptrigger, "双射器", "doubletaptrigger", "宿");
	AddItemName(HAMMERPOINT_ROUNDS, "Hammerpoint Rounds", "Hammerpoint Rounds", "宿");
	//AddItemName(89, "穿心膛线", "Skullpiercer Rifling", "列");
	//玄 消焰器
	//SEProtectEnd();
}

BONEIDBYMODEL *GetBoneID(int ModelType)
{
	//SEProtectStartMutation();
	static BONEIDBYMODEL bone;

	if (ModelType == TYPE_MODEL1)				//寻血猎犬
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 49;		//左肩
		bone.Right_shoulder = 16;		//右肩
		bone.Left_arm = 51;				//左臂
		bone.Right_arm = 18;			//右臂
		bone.Left_arm_1 = 54;			//左臂1
		bone.Right_arm_1 = 24;			//右臂1
		bone.Left_arm_2 = 93;			//左臂2
		bone.Right_arm_2 = 88;			//右臂2
		bone.Left_knee = 94;			//左膝盖
		bone.Right_knee = 90;			//右膝盖
		bone.Left_foot = 68;			//左脚
		bone.Right_foot = 91;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL2)				//直布罗陀
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 42;		//左肩
		bone.Right_shoulder = 15;		//右肩
		bone.Left_arm = 46;				//左臂
		bone.Right_arm = 19;			//右臂
		bone.Left_arm_1 = 49;			//左臂1
		bone.Right_arm_1 = 21;			//右臂1
		bone.Left_arm_2 = 78;			//左臂2
		bone.Right_arm_2 = 73;			//右臂2
		bone.Left_knee = 79;			//左膝盖
		bone.Right_knee = 74;			//右膝盖
		bone.Left_foot = 81;			//左脚
		bone.Right_foot = 76;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL3)				//命脉
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 39;		//左肩
		bone.Right_shoulder = 14;		//右肩
		bone.Left_arm = 41;				//左臂
		bone.Right_arm = 16;			//右臂
		bone.Left_arm_1 = 43;			//左臂1
		bone.Right_arm_1 = 18;			//右臂1
		bone.Left_arm_2 = 68;			//左臂2
		bone.Right_arm_2 = 63;			//右臂2
		bone.Left_knee = 70;			//左膝盖
		bone.Right_knee = 65;			//右膝盖
		bone.Left_foot = 71;			//左脚
		bone.Right_foot = 66;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL4)				//探路者
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 27;		//左肩
		bone.Right_shoulder = 14;		//右肩
		bone.Left_arm = 29;				//左臂
		bone.Right_arm = 16;			//右臂
		bone.Left_arm_1 = 30;			//左臂1
		bone.Right_arm_1 = 17;			//右臂1
		bone.Left_arm_2 = 70;			//左臂2
		bone.Right_arm_2 = 66;			//右臂2
		bone.Left_knee = 71;			//左膝盖
		bone.Right_knee = 67;			//右膝盖
		bone.Left_foot = 72;			//左脚
		bone.Right_foot = 68;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL5)				//动力小子(需要收集)
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 44;		//左肩
		bone.Right_shoulder = 15;		//右肩
		bone.Left_arm = 46;				//左臂
		bone.Right_arm = 17;			//右臂
		bone.Left_arm_1 = 48;			//左臂1
		bone.Right_arm_1 = 19;			//右臂1
		bone.Left_arm_2 = 68;			//左臂2
		bone.Right_arm_2 = 40;			//右臂2
		bone.Left_knee = 92;			//左膝盖
		bone.Right_knee = 82;			//右膝盖
		bone.Left_foot = 89;			//左脚
		bone.Right_foot = 84;			//右脚
		return &bone;
	}

	else if (ModelType == TYPE_MODEL6)				//恶灵
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 40;		//左肩
		bone.Right_shoulder = 15;		//右肩
		bone.Left_arm = 42;				//左臂
		bone.Right_arm = 17;			//右臂
		bone.Left_arm_1 = 45;			//左臂1
		bone.Right_arm_1 = 20;			//右臂1
		bone.Left_arm_2 = 96;			//左臂2
		bone.Right_arm_2 = 91;			//右臂2
		bone.Left_knee = 97;			//左膝盖
		bone.Right_knee = 92;			//右膝盖
		bone.Left_foot = 99;			//左脚
		bone.Right_foot = 94;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL7)				//班加罗尔
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 43;		//左肩
		bone.Right_shoulder = 15;		//右肩
		bone.Left_arm = 46;				//左臂
		bone.Right_arm = 18;			//右臂
		bone.Left_arm_1 = 49;			//左臂1
		bone.Right_arm_1 = 20;			//右臂1
		bone.Left_arm_2 = 86;			//左臂2
		bone.Right_arm_2 = 81;			//右臂2
		bone.Left_knee = 87;			//左膝盖
		bone.Right_knee = 82;			//右膝盖
		bone.Left_foot = 89;			//左脚
		bone.Right_foot = 84;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL8)				//侵蚀(需要收集)
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 39;		//左肩
		bone.Right_shoulder = 14;		//右肩
		bone.Left_arm = 41;				//左臂
		bone.Right_arm = 16;			//右臂
		bone.Left_arm_1 = 43;			//左臂1
		bone.Right_arm_1 = 18;			//右臂1
		bone.Left_arm_2 = 68;			//左臂2
		bone.Right_arm_2 = 63;			//右臂2
		bone.Left_knee = 70;			//左膝盖
		bone.Right_knee = 65;			//右膝盖
		bone.Left_foot = 71;			//左脚
		bone.Right_foot = 66;			//右脚

		return &bone;
	}

	else if (ModelType == TYPE_MODEL9)				//幻象
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 41;		//左肩
		bone.Right_shoulder = 14;		//右肩
		bone.Left_arm = 43;				//左臂
		bone.Right_arm = 16;			//右臂
		bone.Left_arm_1 = 45;			//左臂1
		bone.Right_arm_1 = 19;			//右臂1
		bone.Left_arm_2 = 89;			//左臂2
		bone.Right_arm_2 = 84;			//右臂2
		bone.Left_knee = 90;			//左膝盖
		bone.Right_knee = 85;			//右膝盖
		bone.Left_foot = 92;			//左脚
		bone.Right_foot = 87;			//右脚

		return &bone;
	}
	else
	{
		bone.head = 10;					//头
		bone.neck = 9;					//脖子
		bone.abdomen = 5;				//腹部
		bone.Left_shoulder = 39;		//左肩
		bone.Right_shoulder = 14;		//右肩
		bone.Left_arm = 41;				//左臂
		bone.Right_arm = 16;			//右臂
		bone.Left_arm_1 = 43;			//左臂1
		bone.Right_arm_1 = 18;			//右臂1
		bone.Left_arm_2 = 68;			//左臂2
		bone.Right_arm_2 = 63;			//右臂2
		bone.Left_knee = 70;			//左膝盖
		bone.Right_knee = 65;			//右膝盖
		bone.Left_foot = 71;			//左脚
		bone.Right_foot = 66;			//右脚

		return &bone;
	}
	return NULL;
	//SEProtectEnd();
}

void CCheats::DrawBone(ACTOR_INFO *pAI)
{
	//SEProtectStartMutation();
	CBaseEntity* player = (CBaseEntity*)pAI->dwPtr;
	if (!player)
		return;
	Vector out[128];
	Vector2D out2D[128];
	GColor c;
	player->GetBoneMarx(out);
	c.SetGColor(0, 255, 255, 255);
	for (int i = 0; i < 128; i++)
	{
		I::Engine->W2S(out[i], out2D[i]);
	}
	BONEIDBYMODEL *bone = GetBoneID(pAI->modeltype);


	//	头->脖子
	D->DrawLine(out2D[bone->head], out2D[bone->neck], c.GetRawGColor());

	//	左右锁骨->左右肩
	D->DrawLine(out2D[bone->neck], out2D[bone->Left_shoulder], c.GetRawGColor());
	D->DrawLine(out2D[bone->neck], out2D[bone->Right_shoulder], c.GetRawGColor());

	//	左右肩->左右臂
	D->DrawLine(out2D[bone->Left_shoulder], out2D[bone->Left_arm], c.GetRawGColor());
	D->DrawLine(out2D[bone->Right_shoulder], out2D[bone->Right_arm], c.GetRawGColor());
	D->DrawLine(out2D[bone->Left_arm], out2D[bone->Left_arm_1], c.GetRawGColor());
	D->DrawLine(out2D[bone->Right_arm], out2D[bone->Right_arm_1], c.GetRawGColor());
	D->DrawLine(out2D[bone->Left_arm_1], out2D[bone->Left_arm_2], c.GetRawGColor());
	D->DrawLine(out2D[bone->Right_arm_1], out2D[bone->Right_arm_2], c.GetRawGColor());

	//	脖子->腹部
	D->DrawLine(out2D[bone->neck], out2D[bone->abdomen], c.GetRawGColor());


	//	腹部->左右膝盖
	D->DrawLine(out2D[bone->abdomen], out2D[bone->Left_knee], c.GetRawGColor());
	D->DrawLine(out2D[bone->abdomen], out2D[bone->Right_knee], c.GetRawGColor());

	//	左右膝盖->左右脚
	D->DrawLine(out2D[bone->Left_knee], out2D[bone->Left_foot], c.GetRawGColor());
	D->DrawLine(out2D[bone->Right_knee], out2D[bone->Right_foot], c.GetRawGColor());
	D->DrawLine(out2D[bone->Left_foot], out2D[bone->Left_foot], c.GetRawGColor());
	D->DrawLine(out2D[bone->Right_foot], out2D[bone->Right_foot], c.GetRawGColor());

	//SEProtectEnd();


	/*
	Vector out[128];
	GetActor()->GetBone(pAI->dwPtr, pAI->orgin, out);
	Vector2D out2D[128];

	for (int i = 0; i < 128; i++)
	{
	if (world2screen(out[i], out2D[i]))
	{
	//GColor c;
	//c.SetGColor(0, 0, 0, 220);
	//DrawString(13, Vector2D(out2D[i].x, out2D[i].y), c.GetRawGColor(), true, true, "%d", i);
	}
	}


	GColor c;
	c.SetGColor(243, 107, 114, 255);

	//	头->脖子
	D->DrawLine(out2D[BoneId::head], out2D[BoneId::neck], c.GetRawGColor());

	//	脖->左右锁骨
	D->DrawLine(out2D[BoneId::neck], out2D[BoneId::Left_clavicle], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::neck], out2D[BoneId::Right_clavicle], c.GetRawGColor());

	//	左右锁骨->左右肩
	D->DrawLine(out2D[BoneId::Left_clavicle], out2D[BoneId::Left_shoulder], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Right_clavicle], out2D[BoneId::Right_shoulder], c.GetRawGColor());

	//	左右肩->左右臂
	D->DrawLine(out2D[BoneId::Left_shoulder], out2D[BoneId::Left_arm], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Right_shoulder], out2D[BoneId::Right_arm], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Left_arm], out2D[BoneId::Left_arm_1], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Right_arm], out2D[BoneId::Right_arm_1], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Left_arm_1], out2D[BoneId::Left_arm_3], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Right_arm_1], out2D[BoneId::Right_arm_3], c.GetRawGColor());

	//	脖子->胸
	D->DrawLine(out2D[BoneId::neck], out2D[BoneId::chest], c.GetRawGColor());

	//	胸->腹部
	D->DrawLine(out2D[BoneId::chest], out2D[BoneId::abdomen], c.GetRawGColor());

	//	腹部->左右膝盖
	D->DrawLine(out2D[BoneId::abdomen], out2D[BoneId::Left_knee], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::abdomen], out2D[BoneId::Right_knee], c.GetRawGColor());

	//	左右膝盖->左右脚
	D->DrawLine(out2D[BoneId::Left_knee], out2D[BoneId::Left_foot], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Right_knee], out2D[BoneId::Right_foot], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Left_foot], out2D[BoneId::Left_foot_1], c.GetRawGColor());
	D->DrawLine(out2D[BoneId::Right_foot], out2D[BoneId::Right_foot_1], c.GetRawGColor());
	*/
}

void CCheats::DrawHighlight(ACTOR_INFO *pAI, bool bIsVisible)
{
	//SEProtectStartMutation();
	static float fColor[3] = { 0.f, 1.f, 0.5f };
	if (bIsVisible)
	{
		fColor[0] = 0.f;
		fColor[1] = 250.f;
		fColor[2] = 154.f;
	}
	*(bool*)(pAI->dwPtr + 0x390) = true;
	*(bool*)(pAI->dwPtr + 0x310) = true;
	*(float*)(pAI->dwPtr + 0x2FC) = FLT_MAX;
	*(float**)(pAI->dwPtr + 0x1D0) = fColor;
	for (auto i = 0x2D0; i <= 0x2E8; i += 0x4)
		*(float*)(pAI->dwPtr + i) = FLT_MAX;
	//SEProtectEnd();
}

void BulletTrace(CBaseEntity* entity)
{
	//SEProtectStartMutation();
	Vector src3D, dst3D, forward;
	Vector2D  src, dst;
	trace_t tr;
	ZeroMemory(&tr, sizeof(tr));
	Ray_t ray;
	ZeroMemory(&ray, sizeof(ray));

	AngleVectors(entity->GetEyeAngles(), &forward);
	src3D = entity->GetBonePosition(10) - Vector(0, 0, 0);
	dst3D = src3D + (forward * Vars.Visuals.MaxSpot);
	ray.Init(src3D, dst3D);
	I::EngineTrace->TraceRay(ray, 0x640400B, &tr);
	//world2screen = (_GameWorldToSceen)(global::g_hGameImage + OFFSET::g_dwWorldToScreenEP);
	//if (!world2screen(src3D, src) || !world2screen(tr.endpos, dst))
	//	return;
	if (!I::Engine->W2S(src3D, src) || !I::Engine->W2S(tr.endpos, dst))
		return;
	GColor c;
	c.SetGColor(0, 255, 0, 255);
	D->DrawLine(src,dst, c.GetRawGColor());
	//D::DrawRect(dst.x - 3, dst.y - 3, 6, 6, color);
	//SEProtectEnd();
}
void DrawPlayerWeapon(CBaseEntity* entity)
{
	int id = entity->GetWeaponID();
	if (id == -1)
		return;
	string weapon = "unknown";
	switch (id)
	{
	case WEAPONID_G7侦查枪:weapon = "G7"; break;
	case WEAPONID_R301:weapon = "R301"; break;
	}
}
void CCheats::ESP()
{
	//SEProtectStartMutation();

//	world2screen = (_GameWorldToSceen)(global::g_hGameImage + OFFSET::g_dwWorldToScreenEP);
	ACTOR_INFO *pLocalPlayer = GetActor()->GetLocalPlayer();
	if (pLocalPlayer == NULL)
		return;
	if (!Vars.Visuals.Enabled)
		return;

	for (int i = 0; i < GetActor()->Get()->GetCount(); i++)
	{
		ACTOR_INFO *pAI = GetActor()->Get()->GetData(i);
		if (pAI == NULL)
			continue;



		//	玩家
		if (pAI->type == TYPE_PLAYER && Vars.Visuals.PlayerEnable)
		{
			BONEIDBYMODEL *bone = GetBoneID(pAI->modeltype);
			if ((DWORD64)G::LocalPlayer == pAI->dwPtr)	//判断自己
				continue;
			if(!pAI->isAlive)
				continue;
			float fDis = (pAI->orgin - pLocalPlayer->orgin).Length() * 0.01905f;	//距离
			if (fDis > Vars.Visuals.MaxPlayerDis)
				continue;
			if (pAI->teamid == G::LocalPlayer->m_iTeamNum())
				continue;
			Vector2D screennike, screenHead;
			if (I::Engine->W2S(pAI->orgin, screennike) && I::Engine->W2S(pAI->head, screenHead))
			{
				//DbgPrintA("666666666666666666666666");
				GColor c;
				//	画框
				int iMiddle = (screennike.y - screenHead.y);
				int iWidth = iMiddle / 5;
				CBaseEntity* player = (CBaseEntity*)pAI->dwPtr;
				if (Vars.Visuals.Box)
				{
					/*
					Vector2D outHead;
					if (world2screen(player->GetBonePosition(BoneId::neck), outHead))
					{
					D->DrawCircle(outHead, 2, GColor::Red().GetRawGColor(), 16, 1);
					}
					*/
					if (fDis < 300)
					{
						if (player->IsVisible(10))
							c.SetGColor(243, 107, 114, 255);
						else
							c.SetGColor(255, 255, 0);

					}
					else
					{
						c.SetGColor(0, 128, 255);
					}
					

					D->DrawBox(Vector2D(screenHead.x - iWidth, screenHead.y), Vector2D(iWidth * 2, iMiddle), c.GetRawGColor(), 2.f);



					/*
					if (pAI->teamid == pLocalPlayer->teamid)
					{
					c.SetGColor(0, 128, 255);
					D->DrawBox(Vector2D(screenHead.x - iWidth, screenHead.y), Vector2D(iWidth * 2, iMiddle), c.GetRawGColor(), 2.f);
					}
					else
					{
					c.SetGColor(243, 107, 114, 255);
					D->DrawBox(Vector2D(screenHead.x - iWidth, screenHead.y), Vector2D(iWidth * 2, iMiddle), c.GetRawGColor(), 2.f);

					}*/

				}
				//骨骼
				if (Vars.Visuals.Skeleton)
				{
						DrawBone(pAI);
				}

				//发光
				if (Vars.Visuals.Glow)
				{
					DrawHighlight(pAI, player->IsVisible(bone->head));
				}

				//	名字

				if (Vars.Visuals.Name)
				{
					c.SetGColor(255, 255, 255, 220);
					D->DrawString(12, Vector2D(screennike.x, screennike.y - 35), c.GetRawGColor(), true, true, "%s", (pAI->name.c_str()));
				}

				//	画血条
				if (Vars.Visuals.Health)
				{
					c.SetGColor(0, 0, 0, 220);
					D->DrawBox(Vector2D(screenHead.x + iWidth + 1, screenHead.y), Vector2D(4, iMiddle), c.GetRawGColor(), 1);
					c.SetGColor(181, 230, 29, 220);
					//	取百分比
					float fHP = (float)pAI->health * 100 / (float)pAI->maxhealth;
					D->DrawFilledBox(Vector2D(screenHead.x + iWidth + 2, screenHead.y + 1 + (100 - fHP) / 100 * iMiddle), Vector2D(2, fHP / 100 * iMiddle - 1), c.GetRawGColor());

				}

				//画距离
				if (Vars.Visuals.Distance)
				{
					c.SetGColor(255, 255, 255, 220);
					D->DrawString(12, Vector2D(screennike.x, screennike.y - 45), c.GetRawGColor(), true, true, "[%.fm]", fDis);
				}


				if (Vars.Visuals.Shield)
				{
					//	画护盾
					c.SetGColor(0, 0, 0, 220);
					D->DrawBox(Vector2D(screenHead.x + iWidth + 5, screenHead.y), Vector2D(4, iMiddle), c.GetRawGColor(), 1);
					c.SetGColor(0, 255, 255, 220);
					//	取百分比
					float fFD = (float)pAI->shieldhealth * 100 / (float)pAI->shieldhealthmax;
					D->DrawFilledBox(Vector2D(screenHead.x + iWidth + 6, screenHead.y + 1 + (100 - fFD) / 100 * iMiddle), Vector2D(2, fFD / 100 * iMiddle - 1), c.GetRawGColor());
				}


				//	画瞄准点
				if (Vars.Visuals.AimSpot)
					BulletTrace((CBaseEntity*)pAI->dwPtr);
			//	if (Vars.Visuals.Weapon)
			//		DrawPlayerWeapon((CBaseEntity*)pAI->dwPtr);
			}



		}
		//int centreX = m_rc.right / 2;
		//int centreY = m_rc.bottom / 2;

		//D->DrawCircle(Vector2D(centreX, centreY), Vars.Rage.FOV , GColor::White().GetRawGColor(), 16, 1);

		//	物品
		if (pAI->type == TYPE_ITEM && Vars.Visuals.ItemEnable)
		{
			float fDis = (pAI->orgin - pLocalPlayer->orgin).Length() * 0.01905f;	//距离
			if (fDis > Vars.Visuals.MaxItemDis)
				continue;
			Vector2D screen;
			float FontSize = 11.f;
			if (I::Engine->W2S(pAI->orgin, screen))
			{
				GColor c;
				
				
				if (pAI->itemtpye == ITEM_WEAPONS && Vars.Visuals.ItemWeapons)	//武器
				{
					c.SetGColor(34, 177, 76, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}
				if (pAI->itemtpye == ITEM_AMMO && Vars.Visuals.ItemAmmo)	//子弹
				{
					c.SetGColor(255, 127, 39, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}

				if (pAI->itemtpye == ITEM_HEALING && Vars.Visuals.ItemHealing)	//治疗物品
				{
					c.SetGColor(128, 255, 255, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}

				if (pAI->itemtpye == ITEM_SHIELD && Vars.Visuals.ItemShield)	//防护物品
				{
					c.SetGColor(128, 0, 255, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}

				if (pAI->itemtpye == ITEM_GRENADES && Vars.Visuals.ItemGrenades)	//投掷物品
				{
					c.SetGColor(255, 0, 0, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}

				if (pAI->itemtpye == ITEM_SCOPES && Vars.Visuals.ItemScopes)	//瞄准镜
				{
					c.SetGColor(255, 128, 192, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}

				if (pAI->itemtpye == ITEM_ATTACHMENTS && Vars.Visuals.ItemAttachments)	//配件
				{
					c.SetGColor(255, 255, 0, 220);
					if (g_ItemHash.count(pAI->nameid))
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%s", fDis, g_ItemHash[pAI->nameid].szCN);
					else
					{
						D->DrawString(FontSize, Vector2D(screen.x, screen.y), c.GetRawGColor(), true, true, "[%.fm]%d", fDis, pAI->nameid);
					}
				}
			}
		}
	}
	//SEProtectEnd();
}
void CCheats::Process()
{
//	//SEProtectStartMutation();
	if (I::Engine->IsInGame())
	{
		GetClientRect(global::g_hGameWnd, &m_rc);
		G::LocalPlayer = (CBaseEntity*)I::ClientEntList->GetClientEntity(I::Engine->GetLocalPlayerID());
		//G::LocalPlayer->GetEyePosition();
		DbgPrintA("LocalPlayer: %d %d %f ", G::LocalPlayer->IsReloading(), G::LocalPlayer->m_ammoInStockpile(), G::LocalPlayer->GetbulletSpeed());
		//DbgPrintA("LocalPlayer: %f %f %f ", G::LocalPlayer->GetEyePosition().x, G::LocalPlayer->GetEyePosition().y, G::LocalPlayer->GetEyePosition().z);
		//DbgPrintA("LocalPlayer2: %f %f %f ", G::LocalPlayer->GetViewAngles().x, G::LocalPlayer->GetViewAngles().y, G::LocalPlayer->GetViewAngles().z);
		GetActor()->Update();
		ESP();
	}
	else
		E::RageBot->m_ent = NULL;

//	//SEProtectEnd();
}
